<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Web scrape a fun, new dataset</title> <meta name="author" content="Brendan Sudol"> <meta name="keywords" content=""> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Web scrape a fun, new dataset"> <meta property="og:description" content="Web scrape a fun, new dataset"> <meta property="og:url" content="https://www.brendansudol.com/writing/scrape-new-data"> <meta property="og:site_name" content="Brendan Sudol"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:title" content="Web scrape a fun, new dataset"> <meta name="twitter:description" content="Web scrape a fun, new dataset"> <meta name="twitter:url" content="https://www.brendansudol.com/writing/scrape-new-data"> <meta name="twitter:image" content="https://www.brendansudol.com/assets/img/misc/bren-doodle-color.png"> <link rel="stylesheet" href="/assets/css/all.css?202012212327"> </head> <body class='site'> <header class='container mx-auto px2 py3 mb2 col-12'> <a href='/' class='h2 bold black mono js-name'>Brendan Sudol</a> </header> <div class='site-wrap'> <div class='container mx-auto px2'><div class="h6 gray">November 2013</div> <h1 class="mt0 mb3 h2 sm-h0">Web scrape a fun, new dataset</h1> <article class="mb3"><p>When I first started learning to code, I thought writing a program to scrape, or fetch information, from a website was the coolest thing ever. With just a few simple commands, I could systematically gather pretty much any piece of text or data from any website I wanted. I still think it’s just as cool and useful today. And it’s a great way to get your hands on a fun, new dataset to explore and analyze.</p> <p>For example, I love ordering food from Seamless.com. Huge selection of restaurants, and quick and easy to place and pay for my order.</p> <p>But there is one feature on Seamless that bugs me – when you first start searching for restaurants near your place, the default ordering of the results is alphabetical. I know a lot of things in life are sorted this way, but Seamless has better signals to use than the first letter of the restaurant name, like estimated delivery time or average rating or number of reviews or even better, relevancy based on my prior orders.</p> <p>That said, maybe this default ordering is moot if users immediately filter down to a particular cuisine, or perhaps users are even reassured by the fact that they see 10 restaurants that all start with ‘A’ as it implies a large offering on Seamless which inspires confidence and leads to more exploring and order completions.</p> <p>This got me wondering, do restaurants that begin with letters at the start of the alphabet get more sales on Seamless just because they’re higher on the page? I wanted to try and find out, but that kind of restaurant sales data isn’t released by Seamless. But maybe I could estimate it – Seamless does tell you how many times each restaurant has been reviewed. This definitely isn’t a perfect proxy for sales (e.g., assumes all restaurants have been on site for same amount of time and likelihood to review across different cuisines and price ranges is same) but it’s maybe fairly decent and I think it’s the best I’m gonna do. Time to scrape the 51 pages of results for Brooklyn restaurants and gather and store the relevant data. I’m using <a href="https://www.ruby-lang.org/en/">Ruby</a> to do this, but there are a lot of great helper libraries out there for other languages too.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># scrape seamless.com for brooklyn restaurant data </span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>         
<span class="nb">require</span> <span class="s2">"open-uri"</span>

<span class="no">BASE_URL</span> <span class="o">=</span> <span class="s1">'http://www.seamless.com/brooklyn/'</span>
<span class="no">OUTPUT_FILE</span> <span class="o">=</span> <span class="s1">'seamless-data.csv'</span>
<span class="no">NUM_PAGES</span> <span class="o">=</span> <span class="mi">51</span> <span class="c1"># total number of pages for brooklyn</span>

<span class="nb">open</span><span class="p">(</span><span class="no">OUTPUT_FILE</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="c1"># add column headers to data file</span>
  <span class="n">f</span><span class="p">.</span><span class="nf">puts</span> <span class="s1">'page|restaurant|first_letter|rating|num_reviews|price'</span>
  <span class="c1"># loop through each page of results </span>
  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="no">NUM_PAGES</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span>
    <span class="c1"># retrieve contents of page and select all restaurant entries</span>
    <span class="n">page</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="no">BASE_URL</span><span class="si">}</span><span class="s2">?page=</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>
    <span class="n">restaurants</span> <span class="o">=</span> <span class="n">page</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s1">'.vendor'</span><span class="p">)</span>
    <span class="c1"># loop through restaurants and output relevant info to csv</span>
    <span class="n">restaurants</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
      <span class="c1"># restaurant name</span>
      <span class="nb">name</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s1">'.title'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">attributes</span><span class="p">[</span><span class="s1">'title'</span><span class="p">].</span><span class="nf">value</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'|'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
      <span class="n">first_letter</span> <span class="o">=</span> <span class="nb">name</span><span class="p">.</span><span class="nf">nil?</span> <span class="p">?</span> <span class="s1">''</span> <span class="p">:</span> <span class="nb">name</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">downcase</span>
      <span class="c1"># rating</span>
      <span class="n">rating</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s1">'.rating'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">attributes</span><span class="p">[</span><span class="s1">'class'</span><span class="p">].</span><span class="nf">value</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="c1"># number of reviews</span>
      <span class="n">reviews_temp</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s1">'.rating'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">attributes</span><span class="p">[</span><span class="s1">'title'</span><span class="p">].</span><span class="nf">value</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'on '</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">num_reviews</span> <span class="o">=</span> <span class="n">reviews_temp</span><span class="p">.</span><span class="nf">nil?</span> <span class="p">?</span> <span class="s1">'0'</span> <span class="p">:</span> <span class="n">reviews_temp</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="c1"># price category</span>
      <span class="n">price_temp</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="nf">css</span><span class="p">(</span><span class="s1">'.priceRating strong'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">price</span> <span class="o">=</span> <span class="n">price_temp</span><span class="p">.</span><span class="nf">nil?</span> <span class="p">?</span> <span class="s1">'n/a'</span> <span class="p">:</span> <span class="n">price_temp</span><span class="p">.</span><span class="nf">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">text</span>
      <span class="c1"># all together</span>
      <span class="n">entry</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="nb">p</span><span class="si">}</span><span class="s2">|</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">|</span><span class="si">#{</span><span class="n">first_letter</span><span class="si">}</span><span class="s2">|</span><span class="si">#{</span><span class="n">rating</span><span class="si">}</span><span class="s2">|</span><span class="si">#{</span><span class="n">num_reviews</span><span class="si">}</span><span class="s2">|</span><span class="si">#{</span><span class="n">price</span><span class="si">}</span><span class="s2">"</span>
      <span class="c1"># add to csv</span>
      <span class="n">f</span><span class="p">.</span><span class="nf">puts</span> <span class="n">entry</span>
    <span class="k">end</span>
    <span class="c1"># pause for ~2 seconds before next page request</span>
    <span class="nb">sleep</span> <span class="mf">1.5</span> <span class="o">+</span> <span class="nb">rand</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>With that, I now have a file with 1,260 entries for each Brooklyn restaurant on Seamless along with their average rating (1-5), total number of reviews, and price (1-5). The data file looks like this:</p> <figure class="highlight"><pre><code class="language-text" data-lang="text">page|restaurant|first_letter|rating|num_reviews|price
1|El Viejo Yayo Restaurant|e|rating-3|13|$$$
1|Park Plaza Restaurant|p|rating-4|113|$$
1|Hadramout Restaurant|h|rating-3|10|$$$
1|Fatoosh Middle Eastern Pitza &amp; BBQ|f|rating-5|81|$
1|LaylaJones|l|rating-4|146|$$
1|Due Fratelli (Brooklyn)|d|rating-2|188|$$
1|Friendly Deli and Pizza|f|rating-2|7|$
1|Hanson's Restaurant|h|rating-3|21|$
1|Nicky's Vietnamese Sandwiches (Brooklyn)|n|rating-4|49|$
1|Pino's La Forchetta Pizza|p|rating-4|160|$$
...</code></pre></figure> <p>Now it’s time to drop it into <a href="http://www.r-project.org/">R</a>, or your data analysis tool of choice, and do some exploring! Pretty plots and answers (or observations at least) to come in a future post. :)</p> </article> </div> </div> <footer class="container mx-auto p2 mt4 col-12 h5 flex items-center"> <a class="mr2 black underline" href="/">Home</a> <a class="mr2 black underline" href="/writing/">Writing</a> <a class="mr2 black underline" href="https://github.com/brendansudol">Github</a> <a class="mr2 black underline" href="https://twitter.com/brensudol">Twitter</a> <a href="https://getwemoji.com/" target="_blank"> <img class="align-middle" src="/assets/img/misc/peace.gif" width="24" /> </a> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-37353161-5']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script src="/assets/misc/fun.js"></script> </body> </html>
<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Intro to Isomorphic React</title> <meta name="author" content="Brendan Sudol"> <meta name="keywords" content=""> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Intro to Isomorphic React"> <meta property="og:description" content="Intro to Isomorphic React"> <meta property="og:url" content="https://www.brendansudol.com/writing/isomorphic-js"> <meta property="og:site_name" content="Brendan Sudol"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:title" content="Intro to Isomorphic React"> <meta name="twitter:description" content="Intro to Isomorphic React"> <meta name="twitter:url" content="https://www.brendansudol.com/writing/isomorphic-js"> <meta name="twitter:image" content="https://www.brendansudol.com/assets/img/misc/bren-doodle-color.png"> <link rel="stylesheet" href="/assets/css/all.css?201905062318"> </head> <body class='site'> <header class='container mx-auto px2 py3 mb2 col-12'> <a href='/' class='h3 bold black mono js-name'>Brendan Sudol</a> </header> <div class='site-wrap'> <div class='container mx-auto px2'><div class='h6 gray'>June 2016</div> <h1 class='mt0 mb3 h2 sm-h0'>Intro to Isomorphic React</h1> <article class='mb3'><p>An isomorphic JavaScript app is one that runs the same code on both the server and client. Maybe not quite as cool as the fancy name may suggest, but it’s still pretty freaking cool, especially when paired with React. In essence, you can render a React component on the server and ship the HTML down to the client which then hooks into it and handles any future updates.</p> <p>There are a number of isomorphic tutorials out there, but they all seemed rather complicated and overwhelming to me (and included things more relevant to larger apps, like additional routing and state management libraries). I wanted to make a simple “hello world” like example of an isomorphic React app. So here goes:</p> <h3 id="0-initial-set-up">0. Initial set-up</h3> <p>To get started, you should have Node.js installed and have a basic understanding of using npm and JavaScript modules.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/brendansudol/isomorphic-react-demo.git
$ cd isomorphic-react-demo
$ npm install
</code></pre></div></div> <h3 id="1-the-shared-react-component">1. The shared, React component:</h3> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>


<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span><span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">handleClick</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span><span class="na">count</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">});</span>
  <span class="p">}</span>

  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hi</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">name</span><span class="p">}</span><span class="o">!&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClick</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="nx">Clicks</span><span class="p">:</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span></code></pre></figure> <p>Nothing fancy here. All this component does is say ‘hi’ (to a name passed in as a <code class="highlighter-rouge">prop</code>) and counts the number of button clicks.</p> <h3 id="2-the-server">2. The server:</h3> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="nx">express</span> <span class="k">from</span> <span class="s1">'express'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactDOMServer</span> <span class="k">from</span> <span class="s1">'react-dom/server'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>


<span class="kd">let</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="kr">static</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/static'</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="s1">'port'</span><span class="p">,</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">5000</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="s1">'views'</span><span class="p">,</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/views'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="s1">'view engine'</span><span class="p">,</span> <span class="s1">'ejs'</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s2">"pal"</span><span class="p">};</span>
  <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">ReactDOMServer</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">App</span> <span class="p">{...</span><span class="nx">data</span><span class="p">}</span> <span class="sr">/&gt;</span><span class="se">)</span><span class="err">;
</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">"index"</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">content</span><span class="p">:</span> <span class="nx">content</span><span class="p">,</span>
    <span class="na">state</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">),</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server running on port </span><span class="p">${</span><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">)}</span><span class="s2">...`</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure> <p>And the view (which uses <a href="http://ejs.co/">EJS</a> for templating):</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">__STATE__</span> <span class="o">=</span> <span class="o">&lt;%-</span> <span class="nx">state</span> <span class="o">%&gt;</span>    
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"app"</span><span class="nt">&gt;&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">content</span> <span class="err">%</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/bundle.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure> <p>I’m using Express, a minimal and popular Node.js web application framework.</p> <p>There’s only one route. It checks for a <code class="highlighter-rouge">name</code> URL parameter and passes it to the React component which gets rendered to a string and shipped down to the view (and added within <code class="highlighter-rouge">&lt;div id="app"&gt;</code>). Even if a user has JavaScript disabled, they’ll see the UI elements — woohoo!</p> <h3 id="3-the-client">3. The client:</h3> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">App</span> <span class="k">from</span> <span class="s1">'./components/App'</span><span class="p">;</span>


<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">__STATE__</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'app'</span><span class="p">);</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">App</span> <span class="p">{...</span><span class="nx">data</span><span class="p">}</span> <span class="sr">/&gt;, div</span><span class="se">)</span><span class="sr">;</span></code></pre></figure> <p>The client-side JS picks up where the server left off. React notices the component already on the page and simply attaches event handlers to the relevant elements and handles future UI changes.</p> <p>I’m using <a href="https://webpack.github.io/">Webpack</a> to transpile, bundle, and minify the client-side code (see <a href="https://github.com/brendansudol/isomorphic-react-demo/blob/master/webpack.config.js">config</a> for more details).</p> <h3 id="4-sharing-state">4. Sharing state</h3> <p>One potential thing to keep in mind is sharing the state (i.e., React props) between the server and client. In this example, we pass the state down into the view (alongside the React component string), store it as a JavaScript global variable (<code class="highlighter-rouge">window.__STATE__</code>), and then consume this variable on the client.</p> <h3 id="5-build">5. Build</h3> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm start
</code></pre></div></div> <p>I added a few <a href="https://github.com/brendansudol/isomorphic-react-demo/blob/master/package.json#L5">npm scripts</a> to kick off the web server (as well as watch for changes and run tests).</p> <p>After running <code class="highlighter-rouge">npm start</code> or <code class="highlighter-rouge">npm run serve</code>, open <a href="http://localhost:3000/?name=Bob">http://localhost:3000/?name=Bob</a> and marvel at your new isomorphic app 😊</p> </article> </div> </div> <footer class="container mx-auto p2 mt4 col-12 h5 flex items-center"> <a class="mr2 black underline" href="/">Home</a> <a class="mr2 black underline" href="/writing/">Writing</a> <a class="mr2 black underline" href="https://github.com/brendansudol">Github</a> <a class="mr2 black underline" href="https://twitter.com/brensudol">Twitter</a> <a href="https://getwemoji.com/" target="_blank"> <img class="align-middle" src="/assets/img/misc/peace.gif" width="24" /> </a> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-37353161-5']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <script src="/assets/misc/fun.js"></script> </body> </html>
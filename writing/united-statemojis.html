<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>United Statemojis of Twitter</title> <meta name="author" content="Brendan Sudol"> <meta name="keywords" content=""> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="United Statemojis of Twitter"> <meta property="og:description" content="United Statemojis of Twitter"> <meta property="og:url" content="https://www.brendansudol.com/writing/united-statemojis"> <meta property="og:site_name" content="Brendan Sudol"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:title" content="United Statemojis of Twitter"> <meta name="twitter:description" content="United Statemojis of Twitter"> <meta name="twitter:url" content="https://www.brendansudol.com/writing/united-statemojis"> <meta name="twitter:image" content="https://www.brendansudol.com/assets/img/misc/bren-doodle-color.png"> <link rel="stylesheet" href="/assets/css/all.css?201712071849"> </head> <body class='site'> <div class='site-wrap'> <header class='container mx-auto px2 py3 mt1 mb2'> <a href='/' class='h3 bold black'>Brendan Sudol</a> <nav class='mt-tiny h5'> <a class='mr2 black' href='/writing/'>Writing</a> <a class='mr2 black' href='/projects/'>Projects</a> <a class='mr2 black' href='https://github.com/brendansudol'>Github</a> <a class='black' href='https://twitter.com/brensudol'>Twitter</a> </nav> </header> <div class='container mx-auto pl2 pr2'><div class='h6 gray'>June 2017</div> <h1 class='mt0 mb3 h2 sm-h0'>United Statemojis of Twitter</h1> <article class='mb3 sm-col-4'><p>How does emoji usage on Twitter differ across the United States? Great question! Let’s explore…</p> <div class="py1 post-extra-wide"> <a class="block" href="https://brendansudol.com/emoji-usa/viz/top4/"> <img class="p1 border-box border rounded" src="/assets/img/writing/united-statemojis.png" /> </a> </div> <p><a href="https://brendansudol.com/emoji-usa/viz/top4/">Here’s a larger version</a> of this map, created with d3.js. In addition, all of the code for this analysis is on <a href="https://github.com/brendansudol/emoji-usa">GitHub</a>.</p> <h3 id="details">Details</h3> <p>Using Twitter’s streaming API, I collected ~1.8 million tweets (over a week last month) that were geolocated within the USA. Of those, ~410k tweets contained at least one emoji. From there, I split up the tweets based on the state they came from and then tallied up all of the emojis.</p> <p>A couple initial thoughts: 1) the emoji dictionary is expansive—there were 1,067 different emojis used across all of the tweets. 2) The ”face with tears of joy” emoji (😂) is crazy popular. Of the 821k total emojis (many tweets contain more than one), 16% (134k) were 😂s; this is more than the second (😭), third (❤️), fourth (😍), and fifth (🔥) most popular emojis, combined.</p> <p>If you simply plotted the most commonly used emoji for each state (<a href="https://cl.ly/ksug">which I did at first</a>), it’s a pretty boring and repetitive map with 49 😂s out of 51 (including DC). To overcome the monotony, we can compute the “term frequency–inverse document frequency” (<strong>tf–idf</strong> for short) for each emoji. This is a numerical technique to determine words (emojis) that are significant to a document (tweets within a state) within a larger corpus (all USA tweets). As explained by <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">Wikipedia</a>, ”the tf-idf value increases proportionally to the number of times a word appears in the document, but is often offset by the frequency of the word in the corpus, which helps to adjust for the fact that some words appear more frequently in general.”</p> <p>With emojis ranked by tf-idf, the maps (<a href="https://brendansudol.com/emoji-usa/viz/top1/">top 1</a>, <a href="https://brendansudol.com/emoji-usa/viz/top4/">top 4</a>, also see image above) are a lot more interesting. I love seeing emojis for a state match up with things I associate with that state, like the mountains (🏔) in Alaska and Colorado, volcano (🌋) in Hawaii, shamrock (☘) in Massachusetts, and checkered flag (🏁) in Indiana. I also like seeing the creative use of emojis that resemble letters, like the 〰️ (Wavy Dash) for “W” in Washington or the 🔰 (Japanese Symbol for Beginner) for “V” in Virginia. Some of these don’t make as much sense to me, like the mouse (🐁) in South Dakota or nose (👃) in West Virginia, but that might be more of a reflection on me and my unculturedness 😜.</p> <p>How do you feel about the emojis that represent your state? I hope you think they’re 👌.</p> <h3 id="code">Code</h3> <p>If you’re curious about how I collected and aggregated the data, or want to extend this analysis or do something similar, see below for some code snippets.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="nn">emoji</span> <span class="kn">import</span> <span class="n">UNICODE_EMOJI</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">tweepy</span> <span class="kn">import</span> <span class="n">OAuthHandler</span><span class="p">,</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">StreamListener</span><span class="p">,</span> <span class="n">API</span> <span class="k">as</span> <span class="n">TwApi</span>

<span class="kn">from</span> <span class="nn">util.misc</span> <span class="kn">import</span> <span class="n">CARTOGRAM</span><span class="p">,</span> <span class="n">SKIN_TONES</span><span class="p">,</span> <span class="n">STATE_LOOKUP</span><span class="p">,</span> <span class="n">STATES</span>
<span class="kn">from</span> <span class="nn">util.tfidf</span> <span class="kn">import</span> <span class="n">tfidf</span></code></pre></figure> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TW_CONSUMER_KEY'</span><span class="p">)</span>
<span class="n">CONSUMER_SECRET</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TW_CONSUMER_SECRET'</span><span class="p">)</span>
<span class="n">ACCESS_TOKEN_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TW_ACCESS_TOKEN_KEY'</span><span class="p">)</span>
<span class="n">ACCESS_TOKEN_SECRET</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'TW_ACCESS_TOKEN_SECRET'</span><span class="p">)</span>

<span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s">'data'</span>
<span class="n">USA_BBOX</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">175.1</span><span class="p">,</span> <span class="mf">22.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">59.8</span><span class="p">,</span> <span class="mf">72.3</span><span class="p">]</span>  <span class="c"># via http://boundingbox.klokantech.com/</span></code></pre></figure> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># a few helper functions</span>

<span class="k">def</span> <span class="nf">extract_emojis</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">txt</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">UNICODE_EMOJI</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">sort_values</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_json</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'{}/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">save_to_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'{}/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span> <span class="n">fname</span><span class="p">),</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></code></pre></figure> <p><strong>step 1: fetch tweets (within USA)</strong></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># this uses Twitter's streaming API</span>
<span class="c"># for demo purposes, this only fetches 1k tweets</span>
<span class="c"># (in reality, this ran over several days and collected millions of tweets)</span>

<span class="k">class</span> <span class="nc">MyListener</span><span class="p">(</span><span class="n">StreamListener</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">'retweeted_status'</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'{}/tweets-all.json'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">),</span> <span class="s">'a'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'{}</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">_json</span><span class="p">)))</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'error: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ct</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ct</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'🚨 {} tweets... ({} secs elapsed)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ct</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">((</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">))</span>
            <span class="p">))</span>

        <span class="c"># stop stream after 1k results (for demo)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ct</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
            
    <span class="k">def</span> <span class="nf">on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'uh-oh! ({})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span></code></pre></figure> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">auth</span> <span class="o">=</span> <span class="n">OAuthHandler</span><span class="p">(</span><span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">)</span>
<span class="n">auth</span><span class="o">.</span><span class="n">set_access_token</span><span class="p">(</span><span class="n">ACCESS_TOKEN_KEY</span><span class="p">,</span> <span class="n">ACCESS_TOKEN_SECRET</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TwApi</span><span class="p">(</span><span class="n">auth</span><span class="p">)</span>

<span class="n">stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">MyListener</span><span class="p">())</span>
<span class="n">stream</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="n">USA_BBOX</span><span class="p">)</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>🚨 100 tweets... (4 secs elapsed)
🚨 200 tweets... (8 secs elapsed)
🚨 300 tweets... (13 secs elapsed)
🚨 400 tweets... (17 secs elapsed)
🚨 500 tweets... (21 secs elapsed)
🚨 600 tweets... (26 secs elapsed)
🚨 700 tweets... (29 secs elapsed)
🚨 800 tweets... (34 secs elapsed)
🚨 900 tweets... (38 secs elapsed)
🚨 1000 tweets... (42 secs elapsed)
</code></pre></div></div> <p><strong>step 2: filter tweets to ones containing emojis</strong></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'{}/tweets-all.json'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">emojis</span> <span class="o">=</span> <span class="n">extract_emojis</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'text'</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">200000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'done with {}...'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">emojis</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s">'id'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'id_str'</span><span class="p">],</span>
            <span class="s">'time'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'created_at'</span><span class="p">],</span>
            <span class="s">'user'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'user'</span><span class="p">][</span><span class="s">'screen_name'</span><span class="p">],</span>
            <span class="s">'text'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'text'</span><span class="p">],</span>
            <span class="s">'coordinates'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'coordinates'</span><span class="p">],</span>
            <span class="s">'place'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'place'</span><span class="p">],</span>
            <span class="s">'emojis'</span><span class="p">:</span> <span class="n">emojis</span><span class="p">,</span>
            <span class="s">'emojis_names'</span><span class="p">:</span> <span class="p">[</span><span class="n">UNICODE_EMOJI</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">emojis</span><span class="p">],</span>
        <span class="p">})</span>

<span class="k">print</span><span class="p">(</span><span class="s">'{} tweets with emojis'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered</span><span class="p">)))</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>done with 0...
done with 200000...
done with 400000...
done with 600000...
done with 800000...
done with 1000000...
done with 1200000...
done with 1400000...
done with 1600000...
done with 1800000...
413433 tweets with emojis
</code></pre></div></div> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">save_to_json</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="s">'tweets-w-emojis.json'</span><span class="p">)</span></code></pre></figure> <p><strong>step 3: aggregate by emoji and state</strong></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">get_json</span><span class="p">(</span><span class="s">'tweets-w-emojis.json'</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'coordinates': None,
 'emojis': ['👀', '😏'],
 'emojis_names': [':eyes:', ':smirking_face:'],
 'id': '866461716569350145',
 'place': {'attributes': {},
  'bounding_box': {'coordinates': [[[-85.605166, 30.355644],
     [-85.605166, 35.000771],
     [-80.742567, 35.000771],
     [-80.742567, 30.355644]]],
   'type': 'Polygon'},
  'country': 'United States',
  'country_code': 'US',
  'full_name': 'Georgia, USA',
  'id': '7142eb97ae21e839',
  'name': 'Georgia',
  'place_type': 'admin',
  'url': 'https://api.twitter.com/1.1/geo/id/7142eb97ae21e839.json'},
 'text': "I'm here for Drake and Vanessa... Dranessa 👀😏",
 'time': 'Mon May 22 01:12:25 +0000 2017',
 'user': 'LongLiveDenzy'}
</code></pre></div></div> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">state_cts</span><span class="p">,</span> <span class="n">emoji_cts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">state_emoji_cts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">place</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">'place'</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">place</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="n">country</span><span class="p">,</span> <span class="n">ptype</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s">'country_code'</span><span class="p">],</span> <span class="n">place</span><span class="p">[</span><span class="s">'place_type'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">country</span> <span class="o">!=</span> <span class="s">'US'</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'city'</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">]:</span>
        <span class="k">continue</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">place</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="s">'city'</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">STATE_LOOKUP</span><span class="p">[</span><span class="n">place</span><span class="p">[</span><span class="s">'full_name'</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

    <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="n">state_cts</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">'emojis_names'</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SKIN_TONES</span><span class="p">:</span>
            <span class="n">emoji_cts</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">state_emoji_cts</span><span class="p">[</span><span class="n">state</span><span class="p">][</span><span class="n">e</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span></code></pre></figure> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sort_values</span><span class="p">(</span><span class="n">state_cts</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[('Texas', 55023),
 ('California', 48004),
 ('Florida', 26849),
 ('New York', 20858),
 ('Ohio', 18172),
 ('Georgia', 17905),
 ('Illinois', 13705),
 ('Louisiana', 13586),
 ('North Carolina', 11725),
 ('Pennsylvania', 10869)]
</code></pre></div></div> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sort_values</span><span class="p">(</span><span class="n">emoji_cts</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[(':face_with_tears_of_joy:', 133771),
 (':loudly_crying_face:', 47571),
 (':red_heart:', 30301),
 (':smiling_face_with_heart-eyes:', 28715),
 (':fire:', 18188),
 (':female_sign:', 17195),
 (':weary_face:', 15559),
 (':skull:', 13885),
 (':face_with_rolling_eyes:', 13747),
 (':person_shrugging:', 12666)]
</code></pre></div></div> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># show most popular emojis by state </span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">emojis</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">state_emoji_cts</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s">'state'</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
        <span class="s">'emojis'</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">emojis</span><span class="p">),</span>
        <span class="s">'top_emojis'</span><span class="p">:</span> <span class="n">sort_values</span><span class="p">(</span><span class="n">emojis</span><span class="p">)[:</span><span class="mi">10</span><span class="p">],</span>
    <span class="p">})</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{}:</span><span class="se">\n</span><span class="s">{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">'state'</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s">'top_emojis'</span><span class="p">][:</span><span class="mi">3</span><span class="p">]))</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Alabama:
[(':face_with_tears_of_joy:', 2882), (':loudly_crying_face:', 590), (':female_sign:', 498)]
Alaska:
[(':face_with_tears_of_joy:', 80), (':red_heart:', 50), (':loudly_crying_face:', 33)]
Arizona:
[(':face_with_tears_of_joy:', 1985), (':loudly_crying_face:', 745), (':red_heart:', 718)]
Arkansas:
[(':face_with_tears_of_joy:', 958), (':fire:', 258), (':red_heart:', 221)]
California:
[(':face_with_tears_of_joy:', 13933), (':loudly_crying_face:', 5584), (':red_heart:', 4001)]
</code></pre></div></div> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">save_to_json</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="s">'emojis-by-state.json'</span><span class="p">)</span></code></pre></figure> <p><strong>step 4: add tf-idf (term frequency–inverse document frequency)</strong></p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="n">get_json</span><span class="p">(</span><span class="s">'emojis-by-state.json'</span><span class="p">)</span>
<span class="n">counts_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s">'emojis'</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

<span class="n">data_tfidf</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>    
    <span class="n">counts</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">'emojis'</span><span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">{</span><span class="n">word</span><span class="p">:</span> <span class="n">tfidf</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">counts_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">}</span>
    <span class="n">sorted_words</span> <span class="o">=</span> <span class="n">sort_values</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="n">data_tfidf</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s">'state'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'state'</span><span class="p">],</span>
        <span class="s">'top_counts'</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s">'top_emojis'</span><span class="p">],</span>
        <span class="s">'top_tfidf'</span><span class="p">:</span> <span class="n">sorted_words</span><span class="p">[:</span><span class="mi">10</span><span class="p">],</span>
    <span class="p">})</span></code></pre></figure> <figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># preview results</span>

<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_tfidf</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'{}:'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'state'</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">'top_tfidf'</span><span class="p">][:</span><span class="mi">3</span><span class="p">]):</span>
        <span class="n">word</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">{}. {} tf-idf: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span></code></pre></figure> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Alabama:
    1. :double_exclamation_mark: tf-idf: 0.00104
    2. :speaking_head: tf-idf: 0.00094
    3. :cat_face_with_tears_of_joy: tf-idf: 0.00074
Alaska:
    1. :snow-capped_mountain: tf-idf: 0.00971
    2. :mount_fuji: tf-idf: 0.0053
    3. :passenger_ship: tf-idf: 0.00486
Arizona:
    1. :A_button_(blood_type): tf-idf: 0.00311
    2. :deciduous_tree: tf-idf: 0.00198
    3. :cactus: tf-idf: 0.00138
Arkansas:
    1. :cloud: tf-idf: 0.01442
    2. :double_exclamation_mark: tf-idf: 0.00209
    3. :water_wave: tf-idf: 0.00207
California:
    1. :heavy_minus_sign: tf-idf: 0.00147
    2. :thermometer: tf-idf: 0.0009
    3. :cat_face_with_tears_of_joy: tf-idf: 0.00068
</code></pre></div></div> <div class="h2">✨🇺🇸📊</div> </article> </div> </div> <footer class='p1 center'> <img class='align-middle' src='/assets/img/misc/peace.gif' width='30'> </footer> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-37353161-5']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </body> </html>